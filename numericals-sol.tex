\section*{Источники и решения}

\subsubsection*{Строки и столбцы}

Эта классическая теорема проста и удивительна; о ней мне напомнил Дэн Ромик, сейчас он в Иерусалимском университете.
В третьем томе своего «Искусства программирования» \cite{41} Дональд Кнут проследил историю этого результата до сноски в книге 1955 года Германа Бёрнера \cite{7}.
Бриджет Теннер, студентка знаменитого комбинаторщика Ричарда Стэнли из Массачусетского технологического института, недавно обобщила эту теорему \cite{57}.
Теорема Бёрнера --- одна из тех задач, где таинственность и очевидность чередуются при каждой попытке найти решение.

Положим, что у матрицы $m$ строк и $n$ столбцов, и $a_{ij}$ --- значение в $i$-й строке и $j$-м столбце матрицы после упорядочивания каждой строки.
(Будем считать, что самые маленькие значения находятся слева.)
Обозначим через $b_{ij}$ значение в той же клетке матрицы после упорядочивания столбцов.

Нужно показать, что $b_{ij} \le b_{ik}$ если $j < k$.
Заметим, что $b_{ik}$ это $i$-й наименьший элемент в старом столбце $\{a_{1k}, a_{2k}, \dots, a_{mk}\}$.
Далее, $a_{i'j}\le a_{i'k}$ поскольку $a_{i'j}$ стоит левее $a_{i'k}$ в той же строке.
В частности, если $a_{i'k}\le b_{ik}$, то $a_{i'j}\le b_{ik}$.
Значит, есть как минимум $i$ элементов из старого $j$-го столбца, которые не превосходят $b_{ik}$,
и в частности, $i$-й наименьший элемент в старом $j$-м столбце не превосходит $b_{ik}$;
то есть, $b_{ij} \le b_{ik}$ --- конец доказательства.

Возможн, было бы убедительней разобрать конкретный пример --- решайте сами.

\subsubsection*{Нежелательное раскрытие}

Эту любопытную головоломку мне подкинул Ричард Липтон из компьютерного колледжа Технологического института штата Джорджия.

Естественное решение использует обход дерева в глубину, но вот способ проще:
положим все переменные равными 2!
Поскольку применение распределительного закона не меняет значения выражения, получаем ограничение на длину любого выражения, которое получается из него после раскрытия скобок.

\begin{addedbytheeditors}
Строго говоря, нужно ещё объяснить, почему процесс не может зациклиться.
Для этого достаточно проверить, что при каждом раскрытии скобок увеличивается общее число символов в формуле, или же общее число знаков операций ($+$ и $\times$).
%Другой вариант обоснования получается, если сказать, что каждый шаг увеличивает итоговый результат по крайней мере на $2$, поэтому и число преобразований не может быть бесконечным.
\pr
\end{addedbytheeditors}

\subsubsection*{Хамелеоны}

Эту головоломку прислал Борис Шейн, алгебраист из Университета Арканзаса; скорее всего это древняя задача.
Мне известен случай, когда её дали ученику восьмого класса в Харькове,
и ещё другой, когда её дали выпускнику Гарварда, проходившему собеседование в крупной финансовой фирме; оба справились!

Главное увидеть, что после каждой встречи разница между числом особей любых двух цветов не меняется по модулю~3.
Обозначим через $N_{\text{к}}$ число красных хамелеонов, и пусть
$N_{\text{с}}$ и $N_{\text{з}}$ --- число синих и зелёных.
Мы утверждаем, что, например, у разности $N_{\text{к}} - N_{\text{с}}$ не меняется остаток при делении на~$3$ после каждой встречи хамелеонов.
В этом можно убедиться, проверив каждый случай.
Таким образом, эти разности остаются одинаковыми по модулю 3 навсегда, и поскольку ни одна из них не нуль по модулю 3, нам не удастся избавиться от двух цветов.

С другой стороны, если одна из этих разностей (скажем $N_{\text{к}} - N_{\text{с}}$) положительна и кратна $3$, то её можно уменьшить, заставив красного хамелеона встретиться с зелёным (если зелёных нет, то придётся сначала заставить красного встретиться с синим).
Повторив это несколько раз, можно добиться, что $N_{\text{к}} = N_{\text{с}}$.
Затем заставим красных хамелеонов встречаться с синими, пока не останутся только зелёные.
Собрав всё это воедино и отметив, что если две разницы кратны $3$, то и третья кратна $3$, мы видим следующее:
\begin{itemize}
\item если все три разницы кратны 3, то любой цвет может захватить весь остров;
\item если только одна из разниц кратна 3, то оставшийся цвет --- единственный, который может захватить остров; и наконец,
\item если ни одна из разниц не кратна 3, как в нашей задаче, то все хамелеоны не смогут стать одноцветными до вмешательства других причин (например, рождения или смерти).
\end{itemize}

Эта головоломка была предложена осенью 1984 года на Турнире городов%
\footnote{Автор В. Ильичёв.\pr} (с числами 13, 15 и 17) --- задача 5 в подготовительном варианте для 9---10 классов и основном варианте для 7---8 классов.
Турнир городов, задачи с которого вы ещё увидите, был основан в 1980 году Николаем Константиновым из Москвы.
В то время начиналась перестройка и гласность, это затронуло и математические олимпиады, как и все другие аспекты советской жизни.
Константинов был недоволен определёнными переменами, вышел из жюри Всесоюзной олимпиады и сам организовал турнир для маленьких городов в сельской России.
Он собрал вокруг себя замечательных математиков, и успех турнира в конечном итоге привёл к тому, что Москва сама стала одним из «городов».
Эта же группа основала Независимый московский университет в 1993 году.
Сама же группа превратилась в МЦНМО.%
\footnote{Приведённая история отчасти вымышлена. Историю Турнира городов лучше прочитать в книге А. К. Толпыго \cite{Tolpygo2010}.
История создания Независимого московского университета и МЦНМО описана в буклетe посвящённом его 30-ти летию \cite{mcnmo-30}. \pr}

Турнир распространился в Польшу и Болгарию.
В 1989 году благодаря усилиям Питера Тейлора из Университета Канберры был проведён в Австралии.
В настоящее время Тейлор является исполнительным директором Австралийского математического фонда, под его эгидой он выпустил пять книг о турнире.

В 1990 году Энди Лю привёз Турнир в Канаду.
С тех пор он распространился по всему миру, с участниками из Соединённых Штатов, Западной Европы, Азии и Южной Америки.
Перевод задач и решений на английский язык готовится Андреем Сторожевым и Энди Лю.

\subsubsection*{Отсутствующая цифра}

Эта забавная загадка взята из колонки головоломок Берлекэмпа и Бюлера в журнале Emissary \cite[весна/осень 2006 года]{3},
а они услышали её от специалиста по теории чисел Хендрика Ленстры.
Конечно, можно загуглить ``\texttt{2\^{}29}'' и увидеть число, но как решить эту задачу в уме без головной боли?

Возможно, вы помните технику из начальной школы, так называемое \emph{вычеркивание девяток} --- если сложить все цифры то получим значение числа по модулю 9 (то бишь с тем же остатком при делении на 9).
\footnote{Эта сумма также называется \emph{цифровым корнем} числа. \pr}
Этот метод иногда называют индийской или арабской проверкой;
он основан на том, что $10 \equiv 1 \pmod 9$, следовательно, $10^n \equiv 1^n \equiv 1 \pmod 9$ для любого $n$.
Если обозначить через $x^*$ сумму цифр числа $x$, то получим $(xy)^* \equiv x^* y^* \pmod 9$ для любых $x$ и $y$.

В частности, $(2^n)^* \equiv 2^n \pmod 9$.
Остатки от деления степеней числа $2$ на $9$ начинаются с $2$, $4$, $8$, $7$, $5$, $1$ и зацикливаются;
так что $2^{29} \pmod 9$ есть пятое число этой последовательности, то есть $5$, ведь $29 \equiv 5 \pmod 6$.

Сумма всех цифр равна $10 \times 4{,}5 = 45 \equiv 0 \pmod 9$, поэтому пропущенная цифра должна быть четвёркой.

И действительно, $2^{29} = 536\,870\,912$.

\subsubsection*{Очень честное разбиение}

Эту головоломку мне подбросил Муту Мутукиршнан (Рутгерс),
а сам он узнал её от Боба Тарджана (Принстон) — 
оба великолепные специалисты в информатике.

Такое разбиение существует: $\{1$, $4$, $6$, $7$, $10$, $11$, $13$, $16\}$ и $\{2$, $3$, $5$, $8$, $9$, $12$, $14$, $15\}$.

Чтобы догадаться как его найти, давайте заметим, что $16$ является степенью двойки и попытаемся обобщить.
Можно ли, например, разбить числа от $1$ до $8$ на две равные части с одинаковой суммой и суммой квадратов?
А как насчёт разделения чисел от $1$ до $4$ на две равные части с одинаковой суммой?
Последнее сделать легко: $\{1, 4\}$ и $\{2, 3\}$.
Пара множеств $\{5, 8\}$ и $\{6, 7\}$ разбивают числа от $5$ до $8$, решая ту же задачу.
Если соединить эти два разбиения крест-накрест, то получим $\{1, 4, 6, 7\}$ и $\{2, 3, 5, 8\}$; по построению оно подходит для сумм, но вроде бы подходит и для сумм квадратов.

В общем случае, по индукции можно доказывать, что числа от $1$ до $2^k$ разбиваются на множества $X$ и $Y$ так, что каждая часть имеет одинаковую сумму $j$-х степеней, где $j$ меняется от $0$ до $k - 1$, и, значит, $p(X)=p(Y)$ для любого многочлена $p$ степени меньше $k$;
здесь $p(X)$ определятся как сумма всех значений $p(x)$ при $x \in X$.

Чтобы перейти от $2^{k}$ к $2^{k+1}$, возьмём 
\[X' = X \cup (Y + 2^k)\quad\text{и}\quad Y' = Y \cup (X + 2^k),\]
где $Y + 2^k$ получается из $Y$ добавлением $2^k$ к каждому элементу.
При этом $p(X + 2^k) = p(Y + 2^k)$,
ведь $p(X + 2^k)\z=q(X)$ и $p(Y + 2^k)\z=q(Y)$ для некоторого другого многочлена $q$ той же степени.
Таким образом, $X'$ и $Y'$ согласуются для многочленов степени меньше $k$. 

Ну а что, если степень нашего многочлена равна $k$?

Но и здесь всё в порядке, ведь старшие члены в $r(x+2^k)$ и $r(x)$ совпадают;
то есть $s(x)=r(x+2^k)-r(x)$ есть многочлен степени меньше $k$.
Таким образом,
\begin{align*}
r(X')&=r(X)+r(Y+2^k)=r(X)+r(Y)+s(Y),
\\
r(Y')&=r(Y)+r(X+2^k)=r(Y)+r(X)+s(X).
\end{align*}
Поскольку $s(Y)=s(X)$, получаем, что $r(X')\z=r(Y')$.

%Эта задача напрямую связана с так называемым \emph{многостепенным уравнением}.
%Основной вклад в его изучение внёс Альберт Гроден \cite{gloden}.
% АУ: в русском языке нет такого названия. Бывает задача Терри --- Эскотта, ещё бывает "система уравнений виноградовского типа". Книга Гродена недоступна, трудно сказать, что он там сделал. Но на эту тему есть много других доступных источников. Считаю, что эту добавку Питера будет лучше проигнорировать.
%--- ок.
%АП: Мне понравился откат моих правок и я их почти откатил. Мы все подписываемся под тем, что пишем и как-то надо учитывать моё мнение.

\begin{addedbytheeditors}
Эта задача также была в задачнике Кванта (задача М55; решение в № 8 1971 года).

Повторяя приведённое построение получим разбиение всех натуральных чисел на два подмножсттва, $X$ и $Y$.
Последовательность $a_n$ из нулей и единиц определяемая как $a_n=0$ если $n\in X$ и $a_n=1$ если $n\in Y$ начинается как
 \[0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,\ldots.\]
Это так называемая последовательность Туэ --- Морса.
Её можно построить, начав с нуля, а затем шаг за шагом дописывать к имеющемуся слову его отрицание (где единицы заменены на нули и наоборот).
Легко проверить, что $a_n$ равно сумме цифр в двоичном представлении $n-1$, взятой по модулю $2$.

Последовательность Туэ --- Морса обладает рядом замечательных свойств с которыми очень стоит ознакомиться, она всплывает в теории чисел, теории групп, теории формальных языков, в топологии и даже использовалась в теории шахмат \cite[Глава 1]{salomaa}.

%Решение будет проще, если ставить задачу для набора чисел $\{0,1,\ldots,15\}$. Если на первом шаге начать с множеств $\{0,3\}$ и $\{1,2\}$, то на втором шаге получатся четвёрки $\{0,3,5,6\}$ и $\{1,2,4,7\}$.
%Продолжая этот процесс дальше, мы получим разбиение множества всех целых неотрицательных чисел на два подмножества
%\begin{gather*}
%   M_0=\{0, 3, 5, 6, 9, 10, 12, 15, 17, 18, 20, 23, 24, 27, 29, 30,\ldots\},\\
%   M_1=\{1, 2, 4, 7, 8, 11, 13, 14, 16, 19, 21, 22, 25, 26, 28, 31, \ldots\}.
%\end{gather*}
%Последовательность
%$$\{a_n\}_{n=0}^\infty=\{0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,\ldots\}$$
%задаваемая равенствами
%$$a_n=\begin{cases}
%0,&\text{ если }n\in M_0;\\
%1,&\text{ если }n\in M_1.
%\end{cases}$$
%называется \textit{последовательностью Туэ --- Морса}.
%Она обладает рядом замечательных свойств.
%Её можно построить, начав с 0, а затем на каждом следующем шаге дописывая к имеющемуся слову его отрицание.
%Эта процедура в точности соответствует построениям, описанным в решении.
%Однако, начиная с нуля, мы получаем дополнительное свойство: $a_n$~--- это сумма цифр в двоичном представлении числа $n$, взятая по модулю $2$.
%Таким образом, для решения задачи все числа нужно разбить на две группы в зависимости от чётности суммы цифр.

Если не ограничивать себя множествами из последовательных чисел, то можно найти более короткие наборы чисел с равными суммами степеней.
Так называемая задача Терри --- Эскотта  состоит в нахождении двух непересекающихся множеств целых чисел $X=\{x_1,\ldots,x_n\}$, $Y=\{y_1,\ldots,y_n\}$, для которых
\begin{align*}
    x_1+\ldots+x_n&=y_1+\ldots+y_n,\\
    x_1^2+\ldots+x_n^2&=y_1^2+\ldots+y_n^2,\\
    &\hskip.5em\vdots\\
    x_1^k+\ldots+x_n^k&=y_1^k+\ldots+y_n^k.
\end{align*}
Такую систему равенств иногда записывают в виде $[x_1,\ldots,x_n]=_k[y_1,\ldots,y_n]$.
Например, $[1, 2, 6] =_2 [0, 4, 5 ]$, $[  0, 5, 6, 16, 17, 22] =_5 [1, 2, 10, 12, 20, 21].$
Решения, для которых $n=k+1$, называются \textit{идеальными}.
Идеальные решения известны при $3\le n\le 10$ и для $n=12$.
Постановка задачи восходит к переписке Леонарда Эйлера с Христианом Гольдбахом.
Результаты для малых значений $n$ и $k$ подробно обсуждаются в книге Леонарда Диксона~\cite{Dickson1941}.
Решение с $n=2^k$ было предложено Еженом Пруэ \cite{prouhet}, но публикация долго оставалась незамеченной \cite{writght}.
%Решение задачи с $n=2^k$ было предложено в 1851 г. Пруэ\footnote{E. Prouhet, C. R. Acad. Sci., Paris, vol. 33, 1851, p. 225.}, однако публикация долго оставалась незамеченной.
%Она представляет собой отрывок из мемуара, написанного Пруэ.
%Известно, что сам мемуар вернули автору в 1852 г., и в литературе следов его публикации не сохранилось\footnote{Writght E. M.  Prouhet's 1851 solution of the Tarry-Escott problem of 1910. Amer. Math. Monthly, Vol. 66 (1959) p. 199-201.}. Терри и Эскотт публиковали свои статьи на эту тему в 1910--1912 гг. Результаты для малых значений $n$ и $k$ подробно обсуждаются в книге~\cite{Dickson1941}.
\pr
\end{addedbytheeditors}

\subsubsection*{Восстановление чисел}

Эту головоломку прислал мне Ник Рейнгольд из AT\&T Labs.
Ответ такой: это возможно тогда и только тогда, когда $n$ не степень двойки!
И мы снова применим силу многочленов.

Предположим, что $X = \{x_1 , \dots , x_n\}$ и $Y = \{y_1 , \dots , y_n\}$ --- два различных множества с одинаковыми попарными суммами.
Рассмотрим многочлены
$p(z)=z^{x_1} + z^{x_2} + \dots + z^{x_n}$
и 
$q(z)=z^{y_1} + z^{y_2} + \dots + z^{y_n}$.
По условию, смешанные члены%
\footnote{То есть члены вида $2z^{x_i+x_j}$ при $i\ne j$.} в разложении $p(z)^2$ те же, что и в $q(z)^2$;
то есть,
\[p(z)^2 -q(z)^2 = p(z^2 )-q(z^2).\]
Разделив равенство на $p(z) - q(z)$, получим
\[p(z) + q(z) =
\frac{p(z^2 ) - q(z^2 )}{p(z) - q(z)}.
\]
Поскольку $p(1) = q(1) = n$,
единица является корнем $p(z) - q(z)$; пусть $k$ --- её кратность.
Значит
\[p(z) - q(z) = (z - 1)^k r(z)\]
и
\[p(z^2 ) - q(z^2 ) = (z^2 - 1)^k r(z^2 )= (z - 1)^k (z + 1)^k r(z^2).\]
Сократив дробь на $(z - 1)^k$, получаем
\[p(z) + q(z) =
\frac{(z + 1)^k r(z^2)}{r(z)}.
\]
Подставив $z = 1$, получаем $2n = 2^k$ --- полдела сделано!

Остаётся показать, что если $n$ степень двойки, то
числа не всегда можно восстановить.
Для этого воспользуемся множествами $X$ и $Y$ из предыдущей задачи.
Предположим, что $\{1, \dots , 2^k\}$ разбиты на подмножества $X$ и $Y$ с теми же парными суммами.
Рассмотрим $X' = X \cup (Y + 2^k)$ и $Y' = Y \cup (X + 2^k)$.
Парные суммы $X'$ имеют вид $x_1 + x_2$, $y_1 + y_2 + 2^{k+1}$ и $x + y + 2^k$.
По предположению индукции,
суммы $x_1 + x_2$, те же, что и $y_1 + y_2$.
Значит, попарные суммы из $Y'$ точно те же, что и из $X'$.

\begin{addedbytheeditors}
Про построенный пример можно думать геометрически.
Если $X$ и $Y$ --- множества чётных и нечётных вершин $k$-мерного параллелепипеда, то легко увидеть, что все середины диагоналей с вершинами в $X$ те же, что с вершинами в $Y$.
Остаётся спроецировать параллелепипед на прямую так, чтобы все вершины попали в целые числа.

Как и в предыдущей задаче, пример можно строить и с помощью последовательности Туэ --- Морса.
При этом, между парами с равными суммами из множеств $X$ и $Y$ можно построить взаимно-однозначное соответствие.
Для этого в двоичном представлении каждого числа из пары надо изменить самый младший разряд в котором они отличаются.
\pr
\end{addedbytheeditors}

\subsubsection*{Уравнивание ирисок}

Эта задача была представлена Клиффом Смитом (Массачусетский технологический институт) на прекрасном сайте головоломок «The Puzzle Toad» \cite{bohman-pikhurko-frieze-sleator}, который ведут Том Боман, Олег Пихурко, Алан Фриз и Дэнни Слейтор в Университете Карнеги --- Меллона.
Она появилась на Пекинском математическом соревновании старших классов 1962 года (12 класс, лист II, задача 4).

Пусть $M$ --- максимальное число ирисок у детей в данный момент.
Число $M$ может увеличиться только, если оно нечётное;
в этом случае оно может увеличиться только на единицу до следующего чётного числа.
Чтобы это понять, предположим сначала, что $M$ чётное; тогда оно, конечно же, не изменится при раздаче дополнительных ирисок, а после передачи ирисок ни один ребёнок не сможет иметь больше чем $\tfrac12 M + \tfrac12 M = M$ штук.
Если же $M$ нечётное, то оно увеличится на 1 до следующего чётного числа, а после этого заработает предыдущее рассуждение.

Значит, рано или поздно учитель прекратит раздавать ириски.
Теперь наша задача --- показать, что количества ирисок у всех учеников \emph{сравняются}.

\emph{Неравенство} набора из $n$ чисел с фиксированной суммой хорошо измеряется суммой их квадратов; она минимизируется, если числа стоят как можно ближе друг к другу.
Давайте рассмотрим этот параметр в нашем случае, а именно 
\[S = G^2_1 + G^2_2 + \dots + G^2_n,\]
где $G_i$ --- число ирисок у $i$-го ребёнка.
После передачи ирисок $S$ изменится на
\begin{align*}
\left(\tfrac{1}{2}(G_n+G_1)\right)^2+\left(\tfrac{1}{2}(G_1+G_2)\right)^2+&\dots+\left(\tfrac{1}{2}(G_{n-1}+G_n)\right)^2-
\\
-G_1^2-G_2^2-&\dots-G_n^2=
\\
=-\tfrac12\bigl((G_n-G_1)^2+(G_1-G_2)^2+&\dots+(G_{n-1}-G_n)^2\bigr).
\end{align*}
Если была пара соседей с разным числом ирисок, то это отрицательное целое число (ведь все $G_i$ уже чётные).
Таким образом, $S$ уменьшается каждый раз при передаче ирисок, пока количества ирисок не уравнятся.
И всё доказано, ведь положительное целое число $S$ не может бесконечно уменьшаться.

\medskip

Читатель, знакомый с теорией вероятностей, сможет оценить следующее впечатляющее обобщение этой задачи в стиле Марковских цепей.

Пусть $M=\{p_{ij}\}$ --- матрица перехода эргодической Марковской цепи с конечным числом состояний, и все $p_{ij}$ рациональны.
Предположим, что в конце раунда у $i$-го ребёнка $m_i$ ирисок.
Тогда учитель раздает ириски так, чтобы у $i$-го ребенка стало $n_i$ ирисок, где $n_i\ge m_i$ --- наименьшее число, при котором все числа $p_{ij}n_i$ являются целыми.
Далее, $i$-й ребёнок передаёт $p_{ij}n_i$ ирисок $j$-му ребёнку.

Верно ли, что этот процесс завершается после конечного числа раундов
(и при этом доля ирисок каждого ребёнка станет пропорциональна стационарному распределению цепи Маркова $\{\pi_i\}$)?
Этот вопрос был поставлен примерно в 1975 году моим коллегой из Дартмута Лори Снеллом на математическом семинаре в Кембриджском университете и решён Ричардом Вебером.

Вебер рассматривает целочисленный вектор $(M_1, \dots , M_n)$ пропорциональный $(\pi_1, \dots , \pi_n)$, такой, что каждая компонента $M_i$ не меньше начального числа ирисок у $i$-го ребёнка.
Далее он замечает, что если $m_i \leqslant M_i$ для всех $i$, то и $n_i \leqslant M_i$, ведь пополнение $n_i$ до $M_i$ тоже сработало бы.
Отсюда 
\[m'_j
:=
\sum_i p_{ij} n_i
\leqslant
\sum_i p_{ij} M_i
=
M_j,\] где $m'_j$ --- число ирисок у $j$-го ребёнка в конце раунда.
Воспользовавшись индукцией, можно заключить, что число ирисок у $i$-го ребёнка никогда не превысит $M_i$.

Остаётся проверить, что если учитель не раздает ириски, то доли ирисок у детей приближаются к стационарному распределению.
А это не может продолжаться вечно, ведь у нас лишь конечное число способов распределить ириски.
Следовательно, ириски добавляются конечное время до тех пор, пока их общее число $S\leqslant\sum_iM_i$ не достигнет некоторого значения, на котором стационарное распределение и будет достигнуто.

\subsubsection*{Девяносто девятая цифра}

Эта загадка взята из журнала Emissary \cite[осень 1999]{3} и выглядит довольно сложной.
Даже если пользоваться компьютером, понадобится некоторое терпение (или специальное программное обеспечение).

Вместо этого, обратим внимание на то, что число
\[(1+\sqrt{2})^{500}+(1-\sqrt{2})^{500}\]
целое.
Ведь после раскрытия скобок все нечётные степени $\sqrt{2}$ сократятся.
Второе слагаемое чрезвычайно мало --- поскольку $|1-\sqrt{2}|\z<\tfrac12$, получаем $(\tfrac12)^5<0{,}1$, и, значит, оно гораздо меньше, чем $10^{-100}$ (на самом деле что-то около $4 \times 10^{-192}$).

То есть степени $(1+\sqrt{2})^{500}$ не хватает крошечной величины до целого, и значит, в его десятичной записи есть внушительный ряд девяток после запятой.
(На самом деле их $191$, и за ними следует $590591051\dots$)
В частности, 99-ой цифрой будет девятка.

Фокус с добавлением $(1-\sqrt{2})^{500}$ может показаться возникшим из ниоткуда, но такие пары сопряжённых степеней, одна большая и одна маленькая, часто встречаются в математике.
Например, формула Бине\footnote{Примерно за век до Жака Бине эта формула была известна Леонарду Эйлеру (1707---1783) и Абрахаму де Муавру (1667---1754).}
\[F_n=\frac{1}{\sqrt{5}}\left(\frac{1+\sqrt{5}}2\right)^n-\frac{1}{\sqrt{5}}\left(\frac{1-\sqrt{5}}2\right)^n\]
выдаёт точные значения чисел Фибоначчи $1, 1, 2, 3, 5, 8, 13, 21, 34 \dots$
Второе слагаемое в этой формуле настолько мало, что для любого $n \ge 0$ достаточно вычислить
\[\frac{1}{\sqrt{5}}\left(\frac{1+\sqrt{5}}2\right)^n.\]
Округлив полученное число до ближайшего целого, получим в точности $F_n$.

\begin{addedbytheeditors}
Сходные задачи были популярны в 50---60-х годах прошлого века на математических олимпиадах разных стран.
Аналогичные задачи можно ставить про любое из так называемых \emph{чисел Пизо}; конечно же $\sqrt{2}+1$~--- это пример такого числа.
В общем случае число Пизо (или число Пизо --- Виджаярагхавана, или PV-число) --- это целое алгебраическое число, большее $1$, для которого модули всех сопряжённых строго меньше $1$.
\pr
%\textbf{Редакторам:}
%Я убрал следующий абзац --- по-моему он бессмысленный.
%
%Странно, не так ли?
%По тому же рассуждению $(1+\sqrt{2})^{502}$ также невероятно близко к целому,
%а отношение этих двух огромных степеней равно $(1+\sqrt{2})^{2}$, что равно прозаическому  $5{,}82842712\dots$
\end{addedbytheeditors}

\subsubsection*{Подмножества с ограничениями}

Все три головоломки решаются одним способом.
Первая была представлена давним мастером головоломок Соломоном Голомбом (Университет Южной Калифорнии) на конференции
«Ga\-the\-ring for Gard\-ner VII»;
вторая предложена Прасадом Тетали из Технологического института Джорджии;
третья --- нехитрая её вариация.

Попытайтесь покрыть числа от 1 до 30 такими группами чисел, что из каждой только одно число можно было бы включить в требуемое множество.
Если \emph{получится} собрать подмножество с одним элементом из каждой группы, то оно будет максимальным.

В первом случае рассмотрим любое число $k$ без квадратов (то есть его разложение содержит не больше одной копии любого простого числа).
Теперь посмотрим на множество $S_k$, которое получается умножением $k$ на все возможные квадраты.

С одной стороны, если взять два числа, скажем, $kx^2$ и $ky^2$, из $S_k$, то их произведение будет квадратом: $k^2x^2y^2 = (kxy)^2$.
Поэтому оба числа нельзя включить в наше подмножество.
С другой стороны, произведение пары чисел из разных $S_k$ не может быть квадратом.
Действительно, если $k_1\ne k_2$, то у одного из них будет простой делитель, не встречающийся в другом, и этот делитель появится нечётное число раз в разложении их произведения.

\emph{Каждое} число попадает ровно в одно из множеств $S_k$;
то есть для данного $n$ есть единственное $k$, что $n \in S_k$.
Число $k$ равно произведению простых чисел, входящих с нечётной степенью в разложение $n$ на простые.
Между $1$ и $30$ есть $19$ таких чисел: $1$, $2$, $3$, $5$, $7$, $11$, $13$, $17$, $19$,
$23$, $29$, $2 \times 3$, $2 \times 5$, $2 \times 7$, $2 \times 11$, $2 \times 13$, $3 \times 5$, $3 \times 7$.
Представителем из $S_k$ можно выбрать само $k$.
Таким образом, подмножество размера $19$ достижимо и лучшего не найти.

Если выбирать числа, которые не делятся друг на друга без остатка, то из группы $B_j \z= \{j, 2j, 4j, 8j, \dots\}$ при нечётном $j$ (то есть, $j$ умноженное на всевозможные степени двойки) можно взять только одно число.
В наше множество можно включить всю верхнюю половину, то есть числа от $16$ до $30$, тогда мы получим по одному представителю из каждого $B_j$.
Конечно же, ни одно из этих чисел не делится на другое без остатка, ведь все их отношения меньше $2$.
Таким образом, $15$ полученных чисел составляют наилучшее возможное подмножество.

Наконец, чтобы получить максимальное подмножество попарно взаимно простых, естественно посмотреть на группы из всех кратных фиксированного простого числа $p$.
Представителем такой группы можно взять само $p$. 
И значит, лучшее, что можно сделать — это выбрать $1$ и все простые числа до $30$.
Получится $11$ штук.

\subsubsection*{Единообразие бубликов}

Эта милая головоломка взята с 12-й Московской математической олимпиады 1949 года;
она включена в первую часть «Избранных задач и теорем элементарной математики» %Д. О. Шклярского, Н. Н. Ченцова и И. М. Яглома
\cite[задача 127, стр. 28]{51}.

Предположим, что не все веса одинаковы.
Если все веса целые, то можно прийти к противоречию следующим образом.
Сдвинем веса вниз (это ни на что не влияет), чтобы самый лёгкий бублик стал нулевого веса.
Теперь давайте делить все веса на два до тех пор, пока не появится бублик нечётного веса.
Если отложить бублик с нечётным весом, то сумма весов оставшихся должна быть чётной, иначе невозможно было бы уравновесить чашки весов.
Но то же самое верно, если мы отложим бублик с нулевым весом --- противоречие.

Это рассуждение работает, если все веса рациональны, ведь единицу измерения можно выбрать так, чтобы все веса стали целыми.
Но что, если веса иррациональны?
Кажется заманчивым заменить каждый вес на близкое рациональное число и применить приведённое рассуждение.
Однако эта идея не срабатывает.

Для иррационального случая применим технику посерьёзней.
О вещественных числах $\mathbb{R}$ придётся думать как о векторах над рациональными числами $\mathbb{Q}$;
другими словами, будем считать, что каждое вещественное число это сумма некоторого набора чисел, умноженных на рациональные коэффициенты.
Пусть $V$ будет подпространством (конечномерным), порождённым всеми весами бубликов.
Пусть $r$ --- один из элементов базиса $V$, а $q_i$ --- рациональный коэффициент при $r$ у веса $i$-го бублика, записанного в нашем базисе.
Воспользовавшись рассуждением для рациональных весов, получаем, что все $q_i$ обнуляются, но ведь это означает, что $r$ не содержится в $V$ --- противоречие.

Между прочим, требование класть по шесть бубликов на чашки весов необходимо.
В противном случае можно взять $7$ бубликов по $50$ грамм и $6$ по $70$, и эти $13$ бубликов будут обладать указанным свойством!
Приведённое доказательство разваливается, когда мы сдвигаем все веса;
ровно в этот момент мы использовали, что на каждой чашке весов равное число бубликов.

\begin{addedbytheeditors}
Идея приближения весов всё же срабатывает, но требует дополнительных усилий.
Для этого достаточно найти приближения весов $m_i$ дробями $\tfrac{p_i}q$ так, чтобы неравенства
$|m_i-\tfrac{p_i}q|<\tfrac\varepsilon q$,
выполнялись для всех $i$ и произвольно малого наперёд заданного $\varepsilon>0$.
Эти оценки следуют из теоремы Дирихле о диофантовых приближениях.
Подобным образом была получена вариация решения третьей проблемы Гильберта \cite{benko}. 
\pr
\end{addedbytheeditors}


\subsubsection*{Юбилейная головоломка}

Эта недетская головоломка взята из журнала Emissary \cite[Осень 2004]{3}.
Она появилась на свет гораздо раньше, в статье %великолепного 
английского математика Годфри Х. Харди \cite{37}. 
Харди нашёл правильный ответ и отметил, что ему неизвестно элементарное доказательство.
К счастью, за последующие 100 лет дела изменились.

Ясно, что у Харди не было доступа к компьютеру.
Если бы он попытался вычислять $f(x)$ вручную для различных $x$ близких к $1$, то ему могло бы показаться, что функция сходится к $1/2$.
Несмотря на это, предела не существует.

Следующее милое доказательство нашёл Ноам Элкис, гарвардский математик и композитор \cite[Problem 8]{elkies}.
Предположим, что предел есть%
\footnote{Сам Харди однажды сказал: «\emph{Reductio ad absurdum}, так любимое Евклидом, --- одно из лучших оружий математика.
Этот ход гораздо изощрённей любой партии в шахматы:
шахматист может пожертвовать пешку или даже фигуру, а математик жертвует самой игрой».};
поскольку $f(x)\z=x\z-f(x^2)$, он обязан быть равен $1/2$.
Но $f$ также удовлетворяет соотношению $f(x)\z=x\z-x^2\z+f(x^4)$.
Так как $x^2 < x$, это означает, что последовательность $f(c)$, $f(\sqrt[4]{c})$, $f(\sqrt[16]{c}),\dots$ строго возрастает при любом $c$.
Значит, если $f(c)\ge1/2$ для какого-то $c<1$, то предела нет.
И такое число на самом деле есть; например, $f(0{,}995)=0{,}50088\dots$

Значения $f(x)$ бегают вокруг $1/2$ быстрее и быстрее, туда-сюда по интервалу длины порядка $0{,}0055$.
Может эта функция, капризничает?
Другая функция $g(x)=1-x+x^2-x^3+x^4-\dots$ очень похожа на $f$;
она также определена для положительных $x < 1$, и у неё те же проблемы при $x = 1$.
Однако, добавив $xg(x)$ к $g(x)$, легко увидеть, что $g(x)=1/(x+1)$.
Поэтому $g(x)$ покорно идёт к $1/2$ при $x \to 1$.

%\begin{addedbytheeditors}
%\textbf{Редакторам:}
%Было бы здорово придумать доказательство, которое проверяется в уме --- без %подсчёта $f(0{,}995)$.
%+ хорошо бы добавить график.
%\end{addedbytheeditors}

\subsubsection*{Надёжные мигалки}

Этот замечательный факт (в другом контексте) был обнаружен лордом Рэлеем \cite[раздел 92а]{rayleigh} и, вероятно, переоткрыт много раз после, а может, и до.
Книга И. Дж. Шёнберга \cite{52} --- достойный современный источник. Предупреждение: задача может пригодиться в следующей главе!

Положим, что первая мигалка мигает в моменты времени $pt$ при $t \z= 0, 1, \dots$, а вторая в моменты времени $qt$.
Тогда у первой $1/p$ миганий в минуту, и $1/q$ у второй.
Поскольку вместе в среднем они мигают раз в минуту,  $1/p + 1/q = 1$.

То, что $m$-е мигание первой мигалки произошло во временном интервале $[t, t + 1]$ при целом $t$,
записывается как $\lfloor pm\rfloor = t$, где $\lfloor x\rfloor$ --- целая часть $x$; то есть наибольшее целое число, меньшее или равное~$x$.
Значит, надо доказать, что каждое натуральное число $t$ единственным образом представляется либо как $\lfloor pm\rfloor$ для некоторого натурального $m$, либо как $\lfloor qn\rfloor$ для некоторого $n$, но не и то и другое одновременно!
Может ли такое быть правдой?

%Давайте сначала покажем, что нам не удастся получить и то, и другое сразу; то есть, мы не можем получить два мигания в интервале $[t, t+1]$, где $t$ --- целое число.
%Действительно, если такое случилось, то $pm = t+\delta$ и $qn = t + \varepsilon$, где $m$ и $n$ --- натуральные, а $\delta$ и $\varepsilon$ --- положительные величины, меньшие $1$. 
%Разделив первое уравнение на $p$ и второе на $q$ и сложив, получим
%\[m+n=(\tfrac1p+\tfrac1q)t+\tfrac1p\delta+\tfrac1q\varepsilon.\]
%Но коэффициент при $t$ равен $1$, а сумма оставшихся двух слагаемых — это взвешенная сумма $\delta$ и $\varepsilon$ --- опять-таки положительная величина, меньше $1$, а она никак не может быть разностью двух целых чисел --- противоречие.

%Осталось показать, что мы \emph{действительно} получаем мигание в каждом интервале.
%Для этого достаточно показать, что было ровно $t - 1$ миганий с $0$ по $t$; ведь между временем $0$ и $1$ миганий нет, а как мы уже знаем, после этого в каждом интервале их не может быть более одного.
%А это совсем просто, ведь первая мигалка мигает $\lfloor t/p\rfloor$ раз в этот период, а вторая --- $\lfloor t/q\rfloor$ раз.
%Поскольку $t/p + t/q = t$ и ни $t/p$, ни $t/q$ не являются целыми числами, $\lfloor t/p\rfloor + \lfloor t/q\rfloor$ есть в точности $t - 1$.

Давайте покажем, что было ровно $t - 1$ миганий с $0$ по $t$.
Это совсем просто, ведь первая мигалка мигает $\lfloor t/p\rfloor$ раз в этот период, а вторая --- $\lfloor t/q\rfloor$ раз.
Поскольку $t/p + t/q = t$ и ни $t/p$, ни $t/q$ не являются целыми числами, $\lfloor t/p\rfloor + \lfloor t/q\rfloor$ в точности равно $t - 1$.

Поскольку случилось $t - 1$ миганий с $0$ по $t$ и $t$ миганий с $0$ по $t+1$, случилось ровно одно мигание в интервале $[t,t+1]$ --- задача решена.


%Date: Fri, 28 Jun 2024 10:31:26 +0000
%From: peter winkler <peter.winkler@dartmouth.edu>
%To: "Petrunin, Anton" <petrunin@math.psu.edu>
%Subject: Re: blinkers
%Yes, good point!  BTW my big puzzle book is now
%online free at math.dartmouth.edu/puzzlebook [nam10.safelinks.protection.outlook.com], and
%a lot of the best puzzles from Mindbenders (and
%my first book) can be found there.
%
%  ---Pete
%
%On Thu, Jun 27, 2024 at 11:09 PM Petrunin, Anton <petrunin@math.psu.edu> wrote:
%
%      Dear Peter,
%
%      The par "Let's first..." page 32 in your Benders
%      seems to be redundant --- everything follows from
%      the next par --- if we have t-1 blinks in [0,t]
%      and t blinks om [0,t+1], then we have 1 blink in [t,t+1].
%
%      Can we change remove this par in the transleation?
%
%      A.



\subsubsection*{Красные и синие игральные кости}

Эту замечательную головоломку сообщил мне Дэвид Кемп из Университета Южной Калифорнии; ему потребовался этот результат в статье по информатике.
Похожие результаты нашлись в более ранней статье 
%очень известных математиков
Перси Диакониса, Рона Грэма и Бернда Штурмфельса \cite{14}.

На первый взгляд кажется, что доказательство можно провести  подсчётом: ведь можно получить много различных сумм, выбирая разные подмножества красных костей, и то же самое с синими, и поэтому двум наборам придётся пересечься.
Но вроде бы это не работает;
возьмём к примеру случай $n = 6$,  можно выбросить все тройки красными и все четвёрки синими, тогда для каждого цвета есть всего шесть возможных сумм.
Поэтому наличие пары равных сумм похоже на везение,
хотя в этом случае такая пара есть (четыре красные тройки и три синие четвёрки).

Ещё есть соблазн воспользоваться индукцией по $n$, но и это, вроде, не работает.
Если бы повезло выбросить не более одной $n$-ки каждым набором костей,
то можно было бы удалить по кубику из каждого набора и свести задачу к случаю $n-1$;
но как только $n$-ок оказывается больше, начинаются неприятности.

Что же делать?
Иногда, как это ни странно, \emph{проще усложнить}.
То есть найти более сильное утверждение, которое всё ещё верно, и надеяться, что его легче доказать.
Выставим красные кости в строку, как угодно, и сделаем то же самое с синими костями.
Тогда в каждой строке найдётся по \emph{непустому интервалу} с одинаковыми суммами.

Математически говоря, для данных двух последовательностей  $a_1$, $a_2,\z\dots,a_n$ и $b_1$, $b_2,\dots,b_n$, состоящих из чисел от $1$ до $n$, существуют 
$j\le k$ и 
$s\le t$ такие, что 
\[\sum_{i=j}^ka_i=\sum_{i=s}^tb_i.\]

Пусть $\alpha_m$ обозначает сумму первых $m$ чисел $a_i$,
а $\beta_m$ --- сумму первых $m$ чисел $b_i$.
Предположим, что $\alpha_n\z\ge \beta_n$ (иначе поменяем $a$ и $b$ ролями).
Для данного индекса $m$, пусть $m'$ будет наибольшим индексом, для которого выполняется $\beta_{m'}\le \alpha_m$.

Можно считать, что все $a_i$ записаны в строку слева направо, а $b_i$ стоят под ними.
При этом от каждого $a_m$ проведена стрелка к самому правому $b_\ell$, для которого сумма чисел $b_i$ до $b_\ell$ включительно не превосходит сумму чисел $a_i$ до $a_m$ включительно.
(Конечно же $\ell=m'$.)
На рисунке \ref{pic:kubiki} записаны две такие строки для $n=6$,
разницы сумм написаны на стрелках.

По построению, разница $\alpha_m-\beta_{m'}\ge 0$ не превышает $n-1$ 
(если $\alpha_m-\beta_{m'}\ge n$, то индекс $m'$ не максимален).
Если какая-то из разностей $\alpha_m-\beta_{m'}$ равна $0$, то задача решена ----- в этом случае, взяв $j=s=1$, $k=m$ и $t=m'$, получим два начальных сегмента с одинаковыми суммами.
Если же ни одна из разностей $\alpha_m-\beta_{m'}$ не равна $0$, то все $n$ разностей 
$\alpha_m-\beta_{m'}$ лежат в множестве $\{1,\dots,n-1\}$ и, значит, две из них равны.
Пусть это $\alpha_p-\beta_{p'}$ и $\alpha_q-\beta_{q'}$, тогда 
\[\sum_{i=p+1}^qa_i=\sum_{i=p'+1}^{q'}b_i.\]
--- снова победа.

Ну ведь хитр\'{о} --- без возражений!

\begin{figure}[ht!]
\centering
\begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,scale=1.4,thick]

  \node (1) at (1,0) {\Huge\dice{2}};
  \node (2) at (2,0) {\Huge\dice{4}};
  \node (3) at (3,0) {\Huge\dice{6}};
  \node (4) at (4,0) {\Huge\dice{5}};
  \node (5) at (5,0) {\Huge\dice{3}};
  \node (6) at (6,0) {\Huge\dice{2}};
  \node (7) at (1,-2) {\Huge\dice[black,white]{1}};
  \node (8) at (2,-2) {\Huge\dice[black,white]{3}};
  \node (9) at (3,-2) {\rotatebox[origin=c]{-90}{\Huge\dice[black,white]{3}}};
  \node (10) at (4,-2) {\Huge\dice[black,white]{2}};
  \node (11) at (5,-2) {\Huge\dice[black,white]{3}};
  \node (12) at (6,-2) {\Huge\dice[black,white]{6}};

  
  \path[every node/.style={font=\sffamily\small}]
   (1) edge node[right]{$1$}(7)
   (2) edge node[right]{$2$}(8)
   (3) edge node[left]{$0$}(11)
   (4) edge node[right]{$5$}(11)
   (5) edge node[left]{$2$}(12)
   (6) edge node[right]{$4$}(12);
\end{tikzpicture}
\caption{Две строки из шести кубиков, с соответственными частичными суммами.}
\label{pic:kubiki}
\end{figure}

На рисунке есть одна пара совпадающих разностей (они равны 2), а именно $p=2$, $q=5$, $p'=2$ и $q'=6$, и
вот соответственные подстроки с равными суммами:
\[a_3+a_4+a_5=6+5+3=3+2+3+6=b_3+b_4+b_5+b_6.\]
Ещё на рисунке есть стрелка отмеченная нулём, это даёт другое решение:
\[a_1+a_2+a_3=2+4+6=1+3+3+2+5=b_1+b_2+b_3+b_4+b_5.\]

\begin{addedbytheeditors}
У этой идеи есть и другие применения; иногда неожиданные, как, например, следующий результат \cite{petrunin}:
\textit{Если $\tilde M\to M$ --- $n$-листное локально-изометрическое накрытие компактного риманова многообразия $M$, то $\mathrm{diam}\, \tilde M\le n\cdot \mathrm{diam}\, M$}, где $\mathrm{diam}\, M$ обозначает \textit{диаметр $M$}, то есть максимальное расстояние между парой точек в $M$.\pr
\end{addedbytheeditors}


